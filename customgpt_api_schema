# This schema is used to let the custom GPT retrieve information or take actions outside of ChatGPT
openapi: 3.1.0  # Changed to a more widely supported version
info:
  title: WeySentinel API
  description: API that fetches commit logs, file contents, and the file structure of the Weyoto Assist GitHub repository.
  version: 1.3.0
servers:
  - url: https://weysentinel-assist.weyoto.com
    description: Production Server
paths:
  /get-latest-code:
    get:
      summary: Get Latest Commits
      description: Fetches the latest commits from the Weyoto Assist GitHub repository.
      operationId: getLatestCommits
      security:
        - ApiKeyAuth: []
      responses:
        "200":
          description: A JSON array of recent commits
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Commit"
  /get-file-content:
    get:
      summary: Get File Content
      description: Fetches the content of a specific file in the repository.
      operationId: getFileContent
      parameters:
        - name: path
          in: query
          required: true
          schema:
            type: string
          description: Path of the file in the repository (e.g., "core/models/inquiry.py")
      security:
        - ApiKeyAuth: []
      responses:
        "200":
          description: File content retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FileContent"
        "400":
          description: Missing file path parameter
        "404":
          description: File not found
  /list-files:
    get:
      summary: List All Files
      description: Returns the complete file and folder structure of the repository.
      operationId: listFiles
      security:
        - ApiKeyAuth: []
      responses:
        "200":
          description: A list of file and folder paths
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/FileNode"
components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-KEY
  schemas:
    Commit:
      type: object
      properties:
        sha:
          type: string
          description: Commit SHA hash
        author:
          type: object
          properties:
            login:
              type: string
              description: GitHub username of the author
            avatar_url:
              type: string
              description: URL of the author's avatar
        commit:
          type: object
          properties:
            message:
              type: string
              description: Commit message
            url:
              type: string
              description: Commit URL
    FileContent:
      type: object
      properties:
        file_name:
          type: string
          description: Name of the file
        content:
          type: string
          description: Decoded file content
    FileNode:
      type: object
      properties:
        path:
          type: string
          description: File or directory path
        type:
          type: string
          enum: [blob, tree]
          description: '"blob" for file or "tree" for folder'